# Partitioning
===========================================================================
---------------------------------------------------------------------------
===========================================================================
- Find "Corresponding Partition" of a "Rrecord":

1.
```
SQL> select dbms_rowid.rowid_object(rowid) rowid_
    FROM    ETL_USER.REF_CBS_DATA L
    where   RECORD_DATE >= TO_DATE('2021-03-14 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
        and RECORD_DATE <  TO_DATE('2021-03-15 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
		and PRI_IDENTITY_26='989163005228';
```
2.
```
SQL> select subobject_name from dba_objects where data_object_id=&rowid_;


--------------------------------------------------------------------
SQL> SELECT L.*, O.SUBOBJECT_NAME
FROM 
  (
    SELECT DBMS_ROWID.ROWID_OBJECT(ROWID) DATA_OBJECT_ID, L.*
    FROM SALES L
    --WHERE L.ID = 123
  ) L
  JOIN 
  (
    SELECT SUBOBJECT_NAME, DATA_OBJECT_ID 
    FROM DBA_OBJECTS
  ) O ON O.DATA_OBJECT_ID = L.DATA_OBJECT_ID;
```
===========================================================================
---------------------------------------------------------------------------
===========================================================================
- List of "Table Partitions" owned by 'USER':
```
SQL> SELECT table_name, partition_name, high_value, num_rows, interval 
		FROM   dba_tab_partitions 
		where TABLE_OWNER = '&USER' 
		ORDER BY table_name, partition_name;
```
- list of "Table Partitions" related to 'TABLE_NAME':
```
SQL> select table_name, partition_name, interval 
		from dba_tab_partitions
		where table_name = '&TABLE_NAME';
```
=======================================================
- List of "Index Partitions" owned by 'USER':
```
SQL> select a.index_name, a.locality, a.alignment, b.uniqueness 
		from dba_part_indexes a, dba_indexes b 
		where b.index_name = a.index_name and a.owner='&USER';
```
- List of "Index Partitions" related to 'TABLE_NAME':  
```
SQL> select index_name, partition_name, high_value 
		from dba_ind_partitions 
		where index_name in (select index_name from user_indexes where table_name = '&TABLE_NAME') 
		order by 1,2;
```
=============================================================================
-----------------------------------------------------------------------------
=============================================================================
- Create "Interval" Partitioned Table using "Auto-increment" ID:
```
SQL> CREATE TABLE HR.INTERVAL_TAB 
(
	LOG_ID 				NUMBER(38) 		  GENERATED BY DEFAULT AS IDENTITY,
	LOG_DATE 			DATE 			  NOT NULL,
    RESPONSESTATUSCODE  NUMBER(10)        NOT NULL,
    STARTTIME           VARCHAR2(31 CHAR) NOT NULL,
    ENDTIME             VARCHAR2(31 CHAR) NOT NULL,
	CONSTRAINT LOG_ID_PK PRIMARY KEY (LOG_ID) 
) 
PARTITION BY RANGE (LOG_DATE) 
INTERVAL(NUMTODSINTERVAL(1,'DAY')) 
( 
	PARTITION PART_LOG_0 VALUES LESS THAN (TO_DATE('01-01-2018', 'DD-MM-YYYY'))
);


SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('01-01-2012', 'DD-MM-YYYY'), 	1, 	'08-20-13', 	'08-20-14');
SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('02-01-2012', 'DD-MM-YYYY'), 	2, 	'08-27-19', 	'08-27-20');
SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('03-01-2012', 'DD-MM-YYYY'), 	3, 	'05-13-17', 	'05-13-18');
SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('04-01-2012', 'DD-MM-YYYY'), 	4, 	'05-09-14', 	'05-09-15');
SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('05-01-2012', 'DD-MM-YYYY'), 	5, 	'10-26-14', 	'10-26-15');
SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('06-01-2012', 'DD-MM-YYYY'), 	6, 	'10-15-18', 	'10-15-19');
SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('07-01-2012', 'DD-MM-YYYY'), 	7, 	'06-28-18', 	'06-28-20');
SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('08-01-2012', 'DD-MM-YYYY'), 	8, 	'08-06-15', 	'08-06-20');
SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('09-01-2012', 'DD-MM-YYYY'), 	9, 	'02-19-18', 	'02-19-19');
SQL> INSERT INTO  hr.INTERVAL_TAB  ( LOG_DATE , RESPONSESTATUSCODE , STARTTIME , ENDTIME ) VALUES (TO_DATE('10-01-2012', 'DD-MM-YYYY'), 	10, '07-20-05', 	'07-20-17');

```

- Add New Partition to an Existing Table: \
[www.alibabacloud.com](https://www.alibabacloud.com/help/doc-detail/116879.htm)
```
SQL> ALTER TABLE MOSCH.CE_MEDIA_TASK
      ADD PARTITION P_R_20210102 VALUES LESS THAN (TO_DATE(' 2021-01-02 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))
	  LOGGING
	  NOCOMPRESS 
	  TABLESPACE MOSCHTBS
	  PCTFREE    10
	  INITRANS   1
	  MAXTRANS   255
	  STORAGE    (
	  			INITIAL          80K
	  			NEXT             1M
	  			MINEXTENTS       1
	  			MAXEXTENTS       UNLIMITED
	  			BUFFER_POOL      DEFAULT
	  		   );
```
=============================================================================
-----------------------------------------------------------------------------
=============================================================================
[docs.oracle.com](https://docs.oracle.com/cd/B28359_01/server.111/b32024/part_avail.htm#BJEIEDIA) 
- "Nonprefixed Local" indexes are particularly useful in "historical" databases.

- Create Local Index:
```
SQL> CREATE INDEX hr.interval_tab_INDX ON hr.interval_tab (id) LOCAL;
```
=============================================================================
-----------------------------------------------------------------------------
=============================================================================
- Split a Range Partition:

1.
```
CREATE TABLE sales (dept_no number, part_no varchar2(20), country varchar2(20), rec_date date, amount number)
	PARTITION BY RANGE(rec_date)
	(
	PARTITION q1_2012 VALUES LESS THAN(to_date('2012-04-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')),
	PARTITION q2_2012 VALUES LESS THAN(to_date('2012-07-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')),
	PARTITION q3_2012 VALUES LESS THAN(to_date('2012-10-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')),
	PARTITION q4_2012 VALUES LESS THAN(to_date('2013-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'))
	);
```
2. 
```
INSERT INTO sales VALUES (10, '4519b', 'FRANCE', 	to_date('17-Jan-2012', 'DD-MON-YYYY HH24:MI:SS'), 45000		);
INSERT INTO sales VALUES (20, '3788a', 'INDIA', 	to_date('01-Mar-2012', 'DD-MON-YYYY HH24:MI:SS'), 75000		);
INSERT INTO sales VALUES (40, '9519b', 'US', 		to_date('12-Apr-2012', 'DD-MON-YYYY HH24:MI:SS'), 145000	);
INSERT INTO sales VALUES (20, '3788a', 'PAKISTAN', 	to_date('04-Jun-2012', 'DD-MON-YYYY HH24:MI:SS'), 37500		);
INSERT INTO sales VALUES (40, '4577b', 'US', 		to_date('11-Nov-2012', 'DD-MON-YYYY HH24:MI:SS'), 25000		);
INSERT INTO sales VALUES (30, '7588b', 'CANADA', 	to_date('14-Dec-2012', 'DD-MON-YYYY HH24:MI:SS'), 50000		);
INSERT INTO sales VALUES (30, '9519b', 'CANADA', 	to_date('01-Feb-2012', 'DD-MON-YYYY HH24:MI:SS'), 75000		);
INSERT INTO sales VALUES (30, '4519b', 'CANADA', 	to_date('08-Apr-2012', 'DD-MON-YYYY HH24:MI:SS'), 120000	);
INSERT INTO sales VALUES (40, '3788a', 'US', 		to_date('12-May-2012', 'DD-MON-YYYY HH24:MI:SS'), 4950		);
INSERT INTO sales VALUES (10, '9519b', 'ITALY', 	to_date('07-Jul-2012', 'DD-MON-YYYY HH24:MI:SS'), 15000		);
INSERT INTO sales VALUES (10, '9519a', 'FRANCE', 	to_date('18-Aug-2012', 'DD-MON-YYYY HH24:MI:SS'), 650000	);
INSERT INTO sales VALUES (10, '9519b', 'FRANCE', 	to_date('18-Aug-2012', 'DD-MON-YYYY HH24:MI:SS'), 650000	);
INSERT INTO sales VALUES (20, '3788b', 'INDIA', 	to_date('21-Sep-2012', 'DD-MON-YYYY HH24:MI:SS'), 5090		);
INSERT INTO sales VALUES (40, '4788a', 'US', 		to_date('23-Sep-2012', 'DD-MON-YYYY HH24:MI:SS'), 4950		);
INSERT INTO sales VALUES (40, '4788b', 'US', 		to_date('09-Oct-2012', 'DD-MON-YYYY HH24:MI:SS'), 15000		);
INSERT INTO sales VALUES (20, '4519a', 'INDIA', 	to_date('18-Oct-2012', 'DD-MON-YYYY HH24:MI:SS'), 650000	);
INSERT INTO sales VALUES (20, '4519b', 'INDIA', 	to_date('02-Dec-2012', 'DD-MON-YYYY HH24:MI:SS'), 5090		);
```
3. 
```
SQL> SELECT L.*, O.SUBOBJECT_NAME
FROM 
  (
    SELECT DBMS_ROWID.ROWID_OBJECT(ROWID) DATA_OBJECT_ID, L.*
    FROM SALES L
    --WHERE L.ID = 123
  ) L
  JOIN 
  (
    SELECT SUBOBJECT_NAME, DATA_OBJECT_ID 
    FROM DBA_OBJECTS
  ) O ON O.DATA_OBJECT_ID = L.DATA_OBJECT_ID;
```
4. 
```
SQL> ALTER TABLE sales SPLIT PARTITION q4_2012
	AT (to_date('2012-11-15 00:00:00', 'YYYY-MM-DD HH24:MI:SS'))
	INTO
	(
	PARTITION q4_2012_p1, -- Less than "2012-11-15"
	PARTITION q4_2012_p2  -- More than "2012-11-15"
	); 

DATA_OBJECT_ID    DEPT_NO PART_NO              COUNTRY              REC_DATE               AMOUNT SUBOBJECT_NAME
-------------- ---------- -------------------- -------------------- ------------------ ---------- ------------------------------
         93936         30 9519b                CANADA               01-FEB-12 00:00:00      75000 Q1_2012
         93936         20 3788a                INDIA                01-MAR-12 00:00:00      75000 Q1_2012
         93936         10 4519b                FRANCE               17-JAN-12 00:00:00      45000 Q1_2012
         93932         40 3788a                US                   12-MAY-12 00:00:00       4950 Q2_2012
         93932         30 4519b                CANADA               08-APR-12 00:00:00     120000 Q2_2012
         93932         20 3788a                PAKISTAN             04-JUN-12 00:00:00      37500 Q2_2012
         93932         40 9519b                US                   12-APR-12 00:00:00     145000 Q2_2012
         93933         40 4788a                US                   23-SEP-12 00:00:00       4950 Q3_2012
         93933         20 3788b                INDIA                21-SEP-12 00:00:00       5090 Q3_2012
         93933         10 9519b                FRANCE               18-AUG-12 00:00:00     650000 Q3_2012
         93933         10 9519a                FRANCE               18-AUG-12 00:00:00     650000 Q3_2012
         93933         10 9519b                ITALY                07-JUL-12 00:00:00      15000 Q3_2012
         93937         20 4519a                INDIA                18-OCT-12 00:00:00     650000 Q4_2012_P1
         93937         40 4788b                US                   09-OCT-12 00:00:00      15000 Q4_2012_P1
         93937         40 4577b                US                   11-NOV-12 00:00:00      25000 Q4_2012_P1
         93938         20 4519b                INDIA                02-DEC-12 00:00:00       5090 Q4_2012_P2
         93938         30 7588b                CANADA               14-DEC-12 00:00:00      50000 Q4_2012_P2
```
=============================================================================
-----------------------------------------------------------------------------
=============================================================================



